<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:aop="http://www.springframework.org/schema/aop"
    xmlns:tx="http://www.springframework.org/schema/tx"
    xsi:schemaLocation="
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd">
        
        <bean id="dataSource"
			class="org.springframework.jdbc.datasource.DriverManagerDataSource"
			destroy-method="getCatalog">
			
			<property name="driverClassName" value="com.mysql.jdbc.Driver" />
			<property name="url" value="jdbc:mysql://localhost/procs" />
			<property name="username" value="root" />
			<property name="password" value="" />
		</bean>
		
		<bean id="sessionFactory" class="org.springframework.orm.hibernate4.LocalSessionFactoryBean">
		<property name="dataSource" ref="dataSource"/>
		<property name="configLocation" value="classpath:hibernate.cfg.xml"/>
		</bean>
		
		<bean id="transactionManager" class="org.springframework.orm.hibernate4.HibernateTransactionManager">
		<property name="sessionFactory" ref="sessionFactory" />
		</bean>
		<!-- important: lignes standards, pensez juste Ã  pointer le bon repertoire de vos DAO dans execution(* domain.*.*(..))-->
	 <aop:config>
		<aop:advisor pointcut="execution(* domain.*.*(..))" advice-ref="txAdvice"/>
	</aop:config> 
	<!-- important: lignes standards-->
	 <tx:advice id="txAdvice" transaction-manager="transactionManager">
		<tx:attributes>
	<tx:method name="get*" read-only="true" />
	
	<tx:method name="*"/>
	</tx:attributes>
	</tx:advice>
	<aop:config>
		<aop:aspect id="idMyAop" ref="myAop">
			<aop:before pointcut="execution(* addContact(*))" method="log"/>
		</aop:aspect>
	</aop:config>
	
	<!-- <aop:config>
		<aop:aspect id="idMyAop" ref="myAop">
			<aop:around pointcut="execution(* addContactPeupler(*))" method="log2" arg-names="pjp"/>
		</aop:aspect>
	</aop:config> -->
		
		<bean id="myAop" class="aop.MyAop"></bean>
		
		<bean id="idContactDAO" class="domain.ContactDAO">
			<constructor-arg>
			<ref bean="sessionFactory" />
			</constructor-arg>
		</bean>
		
		<bean id="idContactPeupler" class="entities.Contact">
        	<property name="firstName" value="Katia"/>
        	<property name="lastName" value="Messaoui"/>
        	<property name="email" value="hhh@gmail.com"/>
        	<property name="adresse"><ref bean="idAddress"/> </property>
        	<property name="tels" >
        		<set> <ref bean="idPhonenumber"/></set>
        	</property>
        	<property name="groups"> <set> <ref bean="idContactGroup"/></set></property>
        </bean>
        
       <bean id="idAddress" class="entities.Address">
       	<property name="street" value="ggggg"/>
       	<property name="zip" value="0000" />
       	<property name="country" value="ggggg"/>
       	<property name="city" value="ggggg"/>
       </bean>
       
       <bean id="idPhonenumber" class="entities.PhoneNumber">
       <property name="phoneKind" value="ttttt"/>
       <property name="phoneNumber" value="0000" />
       </bean>
       <!--
       <bean id="idEntreprise"  parent="entities.Contact"></bean>-->
       
       <bean id="idContactGroup" class="entities.ContactGroup">
       	<property name="groupName" value="ggggg"/>
       </bean>
       
       <bean id="idContactPeupler2" class="entities.Contact">
       <constructor-arg type="String"><value>Fatima</value></constructor-arg>
       <constructor-arg type="String"><value>Karim</value></constructor-arg>
       <constructor-arg type="String"><value>karim@gmail.com</value></constructor-arg>
       </bean>
       
       <bean id="idAddress2" class="entities.Address">
       	<property name="street" value="3 rue de Lyon"/>
       	<property name="zip" value="75001" />
       	<property name="country" value="France"/>
       	<property name="city" value="Paris"/>
       </bean>
       
       <bean id="idContactGroup2" class="entities.ContactGroup">
       	<property name="groupName" value="Miage"/>
       </bean>
       
      <!--  <bean id="idContact" class="entities.Contact">
        	<property name="firstName" value="BNP" />
        	
        </bean>
      <bean id="iContact" abstract="true">
       </bean>
       
       <bean id="idEntreprise" parent="idContact" class="org.springframework.samples.jpetstore.entities.Contact">
       <property name="numeroSiret" value="020202093992" />
       </bean> -->
		

</beans>